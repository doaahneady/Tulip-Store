<%- include('./includes/head') %>

<!-- sign up form -->
<div class="container d-flex justify-content-end align-items-center">
  <div class="card-signup shadow-sm">
    <div class="card-body p-4">
      <h3 class="card-title text-center mb-4">Contact Us</h3>
      <form id="contactForm" class="row g-3" novalidate>
        <!-- full name -->
        <div class="mb-3">
          <input
            type="text"
            class="form-control"
            id="inputname"
            placeholder="full name"
          />
          <div class="invalid-feedback">Please enter your full name.</div>
        </div>
        <!-- email -->
        <div class="mb-3">
          <input
            type="email"
            class="form-control"
            id="inputEmail4"
            placeholder="E-mail"
          />
          <div class="invalid-feedback">
            Please enter a valid email address.
          </div>
        </div>

        <!-- subject -->
        <div class="mb-3">
          <input
            type="text"
            class="form-control"
            id="subject"
            placeholder="Subject.."
          />
          <div class="invalid-feedback">Please enter subject for email</div>
        </div>

        <!-- message -->
        <div class="mb-3">
          <label for="exampleFormControlTextarea1" class="form-label"
            >Message</label
          >
          <textarea
            class="form-control"
            id="message"
            rows="3"
            placeholder="Message Text.."
          ></textarea>
        </div>

        <!-- submit sign up -->
        <div class="mt-3">
          <button type="submit" class="btn btn-primary btn-lg">Send</button>
          <button type="button" class="btn btn-primary btn-lg w-auto" onclick="history.back()">
            back
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="toast-fixed">
  <div
    id="signupToast"
    class="toast align-items-center text-bg-success border-0"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body" id="toastMessage"></div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
</div>

<script>
  (function () {
    const form = document.getElementById('contactForm');
    const nameInput = document.getElementById('inputname');
    const emailInput = document.getElementById('inputEmail4');
    const subjectInput = document.getElementById('subject');
    const messageInput = document.getElementById('message');

    const API_BASE = window.API_BASE || 'http://localhost:4000';

    function toast(msg, ok) {
      const el = document.getElementById('toastMessage');
      el.textContent = msg;
      const toastEl = document.getElementById('signupToast');
      toastEl.classList.remove('text-bg-success', 'text-bg-danger');
      toastEl.classList.add(ok ? 'text-bg-success' : 'text-bg-danger');
      const t = new bootstrap.Toast(toastEl);
      t.show();
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const payload = {
        name: nameInput.value.trim(),
        email: emailInput.value.trim(),
        subject: subjectInput.value.trim(),
        message: messageInput.value.trim(),
      };

      fetch(`${API_BASE}/api/contact`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      })
        .then(async (r) => {
          const data = await r.json().catch(() => ({}));
          if (!r.ok) {
            const msg = data?.message || (data?.errors && data.errors.map(e => e.path + ': ' + e.msg).join(', ')) || 'Failed to send message';
            throw new Error(msg);
          }
          return data;
        })
        .then(() => {
          toast('Message sent successfully âœ…', true);
          form.reset();
        })
        .catch((err) => {
          toast(err.message || 'Failed to send message', false);
        });
    });
  })();
</script>
